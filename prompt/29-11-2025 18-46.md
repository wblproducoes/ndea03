# Prompt Melhorado -- Sistema Escolar Node.js (Express) + MySQL/MariaDB (Compat√≠vel com cPanel)

Crie um sistema completo em **Node.js (Express)**, compat√≠vel com
**cPanel**, usando **MySQL/MariaDB** como banco de dados. O sistema deve
gerenciar registros com os seguintes campos:

-   **S√©rie** (texto)
-   **Aluno** (texto)
-   **Mesa** (texto)
-   **Veio?** (Sim/N√£o)
-   **Chamado?** (Sim/N√£o)
-   **Produtos** (texto)

------------------------------------------------------------------------

## üéØ Funcionalidades Principais

### 1) Interface e Estrutura por Tabelas

-   Cada dispositivo/tablet representa um "table" com nome √∫nico e
    persistente.
-   O nome do table:
    -   N√£o muda ao recarregar a p√°gina.
    -   S√≥ pode ser alterado ao digitar a senha **Iesg510@**.
    -   Campo de senha deve ter **autofocus**.
-   Registros organizados por **S√©rie**, na ordem: *Jardim II ‚Üí 5¬∫ Ano*.

------------------------------------------------------------------------

### 2) Altern√¢ncia de Status (Sim/N√£o)

-   Campos **Veio?** e **Chamado?** alternam com **duplo-clique**.
-   Cada altera√ß√£o:
    -   Grava log no banco.
    -   Envia atualiza√ß√£o em tempo real via Socket.IO.
    -   Exibe abaixo do item qual table fez a altera√ß√£o.
    -   O nome do table **n√£o aparece para os outros tables**.
    -   O nome permanece at√© que o **Reset Geral** seja executado.

------------------------------------------------------------------------

### 3) Importa√ß√£o via Excel (.xlsx)

-   Upload permitido **somente mediante senha** (Iesg510@).
-   Excel deve conter colunas: `S√©rie`, `Aluno`, `Mesa`, `Veio`,
    `Chamado`, `Produtos`.
-   Ap√≥s upload:
    -   Inserir/atualizar registros.
    -   Garantir identificador persistente do table.
    -   Notificar todos os dispositivos via Socket.IO.

------------------------------------------------------------------------

### 4) Reset Geral

-   Bot√£o "RESETAR":
    -   Define Veio/Chamado como **N√£o**.
    -   Remove indicadores "alterado por".
    -   Requer senha **Iesg510@**.
    -   Registra log da opera√ß√£o.
    -   Envia atualiza√ß√£o em tempo real.

------------------------------------------------------------------------

### 5) Contadores por S√©rie

-   Para cada s√©rie, mostrar:
    -   Quantos alunos **vieram**.
    -   Quantos foram **chamados**.
-   Atualiza√ß√£o em tempo real.

------------------------------------------------------------------------

### 6) Sincroniza√ß√£o em Tempo Real

Usar **Socket.IO** para: - Mudan√ßas de status. - Upload de Excel. -
Reset geral. - Renomea√ß√£o de table.

------------------------------------------------------------------------

### 7) Logo e Modo Tela Cheia

-   Exibir o logo localmente baixado:\
    `https://saogoncalosp.com.br/wp-content/uploads/2025/10/logo_novo_h_350x100px.svg`
-   Criar bot√£o de **Tela Cheia**.

------------------------------------------------------------------------

### 8) Identificador do Table

-   Ao abrir a p√°gina:
    -   Solicitar nome e fun√ß√£o do table.
    -   Nome precisa ser **√∫nico**.
    -   Mudan√ßa do nome s√≥ com senha de admin.

------------------------------------------------------------------------

### 9) Dashboard Administrativo

Criar painel com login: - Usu√°rio: **admin** - Senha: **Iesg510@**

Funcionalidades: - CRUD de **Fun√ß√µes**: - Administrador\
- Coxia\
- Apresentador - CRUD de **Usu√°rios Administradores**. - P√°gina dedicada
√† importa√ß√£o de Excel, armazenando: - Vers√£o - Data de inclus√£o - Edi√ß√£o
e exclus√£o de registros importados.

------------------------------------------------------------------------

# üì¶ Banco de Dados (MySQL/MariaDB)

Criar as seguintes tabelas:

------------------------------------------------------------------------

### **Tabela: tables**

  Campo        Tipo
  ------------ ----------
  table_id     PK
  table_name   varchar
  created_at   datetime

------------------------------------------------------------------------

### **Tabela: records**

  Campo        Tipo
  ------------ ----------
  id           PK
  table_id     FK
  serie        varchar
  aluno        varchar
  mesa         varchar
  veio         boolean
  chamado      boolean
  produtos     text
  updated_at   datetime

------------------------------------------------------------------------

### **Tabela: changes**

  Campo        Tipo
  ------------ -----------------------
  id           PK
  record_id    FK
  table_id     FK
  field_name   varchar
  old_value    varchar
  new_value    varchar
  changed_at   datetime
  changed_by   varchar (IP/table id)

Cada a√ß√£o administrativa gera entrada nesta tabela.

------------------------------------------------------------------------

# üîó Endpoints Necess√°rios

### **POST /admin/upload-excel**

-   Upload de XLSX + senha\
-   Atualiza banco e envia evento via Socket.IO.

### **POST /admin/reset**

-   Reset total + senha.

### **POST /admin/rename-table**

-   Renomear table (+ senha).

### **GET /api/records?table_id=**

-   Listagem de registros.

### **POST /api/record/:id/toggle**

-   Altern√¢ncia de "veio" ou "chamado".

### **GET /api/counters**

-   Quantitativos por s√©rie.

### **GET /api/tables**

-   Lista tables e nomes.

------------------------------------------------------------------------

# üé® Front-End

-   **Bootstrap 5.3 + JavaScript puro**
-   API via **fetch()**
-   Socket.IO client
-   UI com:
    -   Logo
    -   Tela cheia
    -   Tabelas com toggles
    -   Indicador "Alterado por"
    -   Modal de senha
    -   Contadores din√¢micos

------------------------------------------------------------------------

# üîê Seguran√ßa

-   Todas as a√ß√µes cr√≠ticas usam senha **Iesg510@**.
-   Senha n√£o pode aparecer no c√≥digo cliente.
-   Senha definida tamb√©m por vari√°vel ambiente.

------------------------------------------------------------------------

# üöÄ Deploy em cPanel

-   Criar App Passenger (Node.js).
-   Configurar `package.json` com script de inicializa√ß√£o.
-   Criar banco MySQL no cPanel.
-   Definir `.env` com:
    -   DB_HOST\
    -   DB_USER\
    -   DB_PASS\
    -   DB_NAME\
    -   ADMIN_PASSWORD
-   Configurar rota inicial `app.js` ou `server.js`.

------------------------------------------------------------------------

# üìë Entreg√°veis

-   Backend + frontend completos.
-   Scripts SQL de cria√ß√£o.
-   Template Excel.
-   README com instru√ß√µes de deploy no cPanel.
-   C√≥digo limpo e bem estruturado.
